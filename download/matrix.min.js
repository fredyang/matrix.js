/*! matrix.js v0.3 Â© Fred Yang - semanticsworks.com | www.opensource.org/licenses/mit-license.php */jQuery.Deferred&&function(e,h){function z(a){return function(){for(var b=A.call(arguments),c=0;c<a.length;c++)a[c].apply(this,b)}}function J(a,b){if("string"===typeof a){if(b){for(var c=1,d=k(a);c<d.length;)n(d[c],d[c-1]),c++;a=d[d.length-1]}return U(a)}if(e.isArray(a)){var c=a,m,g=[],f,j={ok:!0};for(m=0;m<c.length;m++)f=c[m],g.push(f),d=0===m?J(f).fail(K(f,j)):d.nextLoad(f).fail(K(g.slice(),j));return u(d)}throw"resource parameter should be an array or string";}function U(a){var b=[],c=k(a);if(1===
c.length)b=L(c[0]);else{for(var d=0;d<c.length;d++)b.push(L(c[d]));b=e.when.apply(e,b)}return u(b).fail(function(){g.unload(a)})}function K(a,b){return function(){b.ok&&(g.unload(a),b.ok=!1)}}function L(a){var b=i(a);if(b){var c=j(a);if(!c){c=b.load(a);if(!c||!c.done)c=e.Deferred().resolve(a,c).promise();b.noRefCount||j(a,c)}"staticLoaded"!==c.refCount&&(c.refCount=c.refCount?c.refCount+1:1);a=c}else a=g(v(a)+".loader").nextLoad(a);return a}function j(a,b){if(a===h)return l;if(b===h){if(1===arguments.length)return l[a];
delete l[a]}else return l[a]=b}function u(a){var b=e.Deferred();a.nextLoad=function(c){var d=A.call(arguments);a.then(function(){g.apply(null,d).then(function(){b.resolve.apply(b,A.call(arguments))},function(){b.reject(c)})},function(){b.reject(c)});return u(b.promise())};a.andLoad=function(){var b=g.apply(null,arguments);return u(e.when(b,a))};return a}function k(a){return a.replace(V,"").split(W)}function M(a){a=N.exec(a.toLowerCase());return!(!a||!(a[1]!=w[1]||a[2]!=w[2]||(a[3]||("http:"===a[1]?
80:443))!=(w[3]||("http:"===w[1]?80:443))))}function x(a){B.href=X.test(a)?a:g.baseUrl+a;M(a)?a=B.href:(a=B.href,a=p(a),a=o?a+(Y.test(a)?"&":"?")+q+"="+o:a);return a}function Z(a){for(var b in a)"string"==typeof a[b]&&(a[b]=r[b][a[b]]);var c=a.staticLoaded||r.staticLoaded.returnFalse,d=a.getSource||r.getSource.getTextByAjax,m=a.compile,f=a.crossSiteLoad,k=a.buildDependencies,l=a.buildUnload;if(!m&&!f)throw"module loader must implement at least one of compile, crossSiteLoad";return function(a){var b=
e.Deferred(),h=b.promise(),i;if(c(a))h.refCount="staticLoaded",b.resolve(a);else{i=g.url(a);if(!m||M(i)){if(!f)throw"loader does not support cross domain loading";if((i=f(a))&&i.done)return i;b.resolve(a,i)}else d(a).then(function(c){if(l){var d=l(c,a);d&&(j(a).unload=d)}k&&(d=k(a,c))&&n(a,d);var d=function(){var d=m&&m(a,c);setTimeout(function(){if(!b.dontResolve){b.resolve(a,d);delete h.defer}},5)},e=n(a);e?g(e).then(d,function(){b.reject(a);delete h.defer}):d()},function(){b.reject(a);delete h.defer});
C(b)||(h.defer=b)}return h}}function p(a){return""===o?a:a.replace(O,"")}function P(a,b){var c=e.extend(!0,{},l);g.unload(a,!0);b&&b();return g(a).done(function(){for(var a in c)l[a]&&c[a]&&(l[a].refCount=c[a].refCount,l[a].url=c[a].url,l[a].moduleId=c[a].moduleId)})}function $(a,b){var c,d=(c=i(a))&&c.depends&&c.depends(a);if(d){c=[];for(var d=k(d),b=k(b),e=0;e<b.length;e++)d.contains(b[e])||c.push(b[e]);return c.length?c.join():null}return b}function aa(a,b){if(a&&!b||b&&!a)return!0;if(!a&&!b)return!1;
a=k(a).sort();b=k(b).sort();if(a.length!=b.length)return!0;for(var c=0;c<a.length;c++)if(a[c]!=b[c])return!0;return!1}function i(a){var b,c;for(c=D.length-1;0<=c&&!(b=D[c](a));c--);b=b||g.defaultLoader;return E[b]}function Q(a,b,c){var d=j(a),e=d.defer;delete d.defer;d.unload=c;e&&e.resolve(a,b())}function R(a){e("<link href='"+g.url(a)+"' rel='stylesheet' type='text/css' loadedByMatrix='1' />").appendTo("head")}var s={},l={},t={},y={},E={},B=document.createElement("a"),W=/,/,V=/\s+/g,A=[].slice,
Y=/\?/,ba=/\.(\w+)$/,ca=/(.+)\.\w+$/,v,S,F,r,n,X=/^http[s]?:\/\/|^\//,N=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,w=N.exec(location.href.toLowerCase())||[],o="",q="v",O,G=[],H=[],I=[],f=Array.prototype,D,T={},g=window.matrix=function(a,b,c){"boolean"!==typeof a&&(c=b,b=a,a=!1);if(b)return a=a&&!e.isReady,b=J(b,c),a&&(e.holdReady(!0),b.done(function(){e.holdReady()})),b.done(da).fail(ea)};f.indexOf=f.indexOf||function(a,b){for(var c=b||0;c<this.length;c++)if(this[c]==a)return c;return-1};f.contains=
f.contains||function(a){return-1!==this.indexOf(a)};f.remove=f.remove||function(a){a=this.indexOf(a);-1!=a&&this.splice(a,1);return this};f.pushUnique=f.pushUnique||function(a){this.contains(a)||this.push(a);return this};f.merge=f.merge||function(a){if(a&&a.length)for(var b=0;b<a.length;b++)this.pushUnique(a[b]);return this};var ea=z(H),da=z(G),fa=z(I),C=e.Deferred().isResolved?function(a){return a.isResolved()}:function(a){return"resolved"==a.state()};e.extend(g,{unload:function(a,b){var c,d;if(e.isFunction(a))b?
I.remove(a):I.push(a);else if("string"===typeof a&&(a=k(a)),1!=a.length)for(c=0;c<a.length;c++)g.unload(a[c]);else if(c=a[0],(d=j(c))&&"staticLoaded"!=d.refCount){if(0===--d.refCount||b)(d=d.unload||i(c).unload)&&d(c),j(c,h),(c=n(c))&&g.unload(c,b);fa()}},url:function(a,b){if("object"===typeof a)for(var c in a)g.url(c,a[c]);else if(b===h){if(1==arguments.length)return s[a]?s[a]:(c=i(a))&&c.url?x(c.url(a)):x(c&&c.fileExt?S(a)+"."+c.fileExt:a);delete s[a]}else{c=g.url(a);var d=x(b);c!=d&&((c=j(a))&&
C(c)?P(a,function(){s[a]=d}):s[a]=d)}},depends:n=function(a,b){if("object"===typeof a)for(var c in a)a.hasOwnProperty(c)&&n(c,a[c]);else if(b===h){if(1==arguments.length){c=t[a];var d=i(a);return d&&d.depends?(d=d.depends(a))&&c?d+","+c:d?d:c:c}delete t[a]}else if(!0===b){if(c=(c=n(a))&&k(c)){for(var d=[],e=0;e<c.length;e++)"module"!==g.fileExt(c[e])&&d.pushUnique(g.url(c[e])),d.merge(n(c[e],!0));return d}}else{var f=$(a,b);c=t[a];aa(f,c)&&(d=j(a),c&&d&&C(d)?P(a,function(){t[a]=f}):t[a]=f)}},baseUrl:"",
hash:function(a,b){arguments.length&&(o=!0===a?e.now():a,q=b!==h?b:q||"v",O=RegExp("[?&]"+q+"=[^&]*"));return""===o?"":q+"="+o},loader:{resolveDependencies:function(a){return function(b){var c=e.Deferred(),d=g.depends(b);d?g(d).done(function(){c.resolve(b,a(b))}):c.resolve(b,a(b));return c.promise()}},set:function(a,b,c){"string"!==typeof b&&(c=b,b=null);var c=y[a]=e.extend(!0,{},y[b],c),d=e.extend(!0,{},c);e.each(["load","unload","url","depends"],function(){var a;if(typeof d[this]=="string"&&(a=
F[this][d[this]]))d[this]=a});e.isPlainObject(d.load)&&(d.load=Z(d.load));if(!e.isFunction(d.load))throw"missing load function from loader";E[a]=e.extend({},E[b],d)},get:function(a){return a?y[a]:y},commands:F={load:{},unload:{},url:{},depends:{}},finders:D=[function(a){return v(a)},function(a){a=v(a);if(a=T[a])return a}],handleFileTypes:function(a,b){for(var b=k(b),c=0;c<b.length;c++)T[b[c]]=a},loadFilters:r={staticLoaded:{},getSource:{},compile:{},crossSiteLoad:{},buildUnload:{},buildDependencies:{}}},
fileExt:v=function(a){return ba.exec(a)[1]},fileName:S=function(a){return ca.exec(a)[1]},module:function(a,b,c,d){e.isFunction(b)&&(d=c,c=b,b=null);var f=j(a);if(!f){var h=e.Deferred(),f=h.promise();f.defer=h;j(a,f)}f.defer.dontResolve=!0;if(b)return n(a,b),g(b).done(function(){Q(a,c,d)});Q(a,c,d)},done:function(a,b){b?G.remove(a):G.push(a)},fail:function(a,b){b?H.remove(a):H.push(a)},defaultLoader:"js"});e(function(){var a=e("script[profile]").first();if(a.length){var b=a.attr("hash");b&&(b=b.split(","),
g.hash("true"==b[0]?!0:b[0],b[1]));if(b=a.attr("baseUrl"))g.baseUrl=b;g(a.attr("profile"))}});var f=g.loader.set,ga=/<@unload>([\w\W]+?)<\/@unload>/i,ha=/<@depends>([\w\W]+?)<\/@depends>/i;e.extend(!0,F,{load:{cacheImage:function(a){var b=e.Deferred(),c=b.promise(),d=g.url(a),f=new Image,f=new Image;f.onload=function(){b.resolve(a,d)};f.onerror=function(){b.reject(a,d)};f.src=d;return c}},unload:{removeCssLinkTag:function(a){var b=x(g.url(a));e("link").filter(function(){return this.href===b&&e(this).attr("loadedByMatrix")}).remove()}},
url:{moduleId:function(a){return a},folder:function(a){var b=i(a).fileExt,b=b?g.fileName(a)+"."+b:a;return g.fileExt(a)+"/"+b}}});e.extend(!0,r,{staticLoaded:{returnFalse:function(){return false},hasScriptTag:function(a){return!!e("script").filter(function(){return p(this.src)===p(g.url(a))}).length},hasCssLinkTag:function(a){return!!e("link").filter(function(){return p(this.href)===p(g.url(a))&&!e(this).attr("loadedByMatrix")}).length}},getSource:{getTextByAjax:function(a){return e.get(g.url(a),
null,null,"text")}},compile:{globalEval:function(a,b){return e.globalEval(b)},localEval:function(a,b){return eval(b)},linkCss:R},crossSiteLoad:{getScript:function(a){var b=e.Deferred(),c=b.promise();c.defer=b;e.getScript(g.url(a)).then(function(){setTimeout(function(){if(!b.dontResolve){b.resolve(a);delete c.defer}},5)},function(){b.reject(a);delete c.defer});return c},linkCss:R},buildUnload:{parseUnloadTag:function(a){return(a=ga.exec(a))&&a[1]&&new Function(a[1])}},buildDependencies:{parseDependsTag:function(a,
b){var c=ha.exec(b);return c&&c[1]||null}}});f("pack",{load:g.loader.resolveDependencies(e.noop),url:"moduleId"});f("js",{load:{staticLoaded:"hasScriptTag",crossSiteLoad:"getScript",compile:"globalEval",buildDependencies:"parseDependsTag",buildUnload:"parseUnloadTag"},fileExt:"js"});f("loader","js",{url:"folder"});f("css",{load:{staticLoaded:"hasCssLinkTag",crossSiteLoad:"linkCss",compile:"linkCss",buildDependencies:"parseDependsTag"},unload:"removeCssLinkTag",fileExt:"css"});f("image",{load:"cacheImage",
noRefCount:!0});g.loader.handleFileTypes("image","jpg,png,bmp,gif")}(jQuery);
